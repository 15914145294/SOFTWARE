 	深圳市中安信业创业投资有限公司	文 件 编号： 
		版号/修改状态：  
		文  件  页 数：   



短链接_性能测试报告
文   档  修   改   记   录
日期	修改原因及内容摘要	修改人	审核人	批准人
2017-9-20	创建	唐念云		
				
				
				
				
				
  拟制：             审核：                 批准： 
  日期：             日期：                 日期： 


目  录
1	概述	3
1.1	项目背景	3
1.2	目的	3
1.3	术语定义	3
1.4	环境配置	3
1.4.1	软硬件配置	3
1.4.2	网络环境	4
1.4.3	参数配置	4
1.5	测试资源	4
1.5.1	相关人员	4
1.5.2	测试时间	4
1.5.3	相关测试工具	4
1.6	预期性能指标	4
2	测试策略与方法	5
2.1	测试思路	5
2.2	测试流程	6
2.3	测试规划	6
3	性能测场景	6
3.1	核心模块测试场景	6
3.1.1	场景1	6
4	测试结果	7
4.1	获取短链接、获取原链接（并发30用户）	7
4.1.1	第一轮测试Apache-jmeter-3.2 summary report如下：	7
4.1.2	第二轮Apache-jmeter-3.2 summary report如下：	7
4.1.3	事务平均响应时间：	8
4.1.4	服务器性能状态	8
4.1.5	网络流量	9
5	测试结论与建议	9
5.1	测试结论：	9









1	概述
1.1	项目背景
先期由于URL过长短信发送条数对应增加。先提供短链接、长链接提供转换功能。以便后期短信、彩信等信息的发送，节省公司成本。
1.2	目的
测试在要求硬件与软件条件下，系统性能是否能满足现场需求。
1.3	术语定义
无
1.4	环境配置
1.4.1	软硬件配置
设备类型	硬件配置	软件配置
Tomcat负载服务器	CPU：Intel(R) Xeon(R) CPU E5-2680 v3 @ 2.50GHz
内存：4G
服务器IP：172.17.48.3	Centos 6.5
Tomcat 8.0
数据库服务器	CPU：Intel(R) Xeon(R) CPU E5-2680 v3 @ 2.50GHz
内存：4G
服务器IP：172.17.48.3	Mysql 
Redis 4.0.1
RabbitMQ 3.6.10
负载产生机器	CPU：Pentium 4  2.0G  2cpu
内存： 4G
硬盘：IDE 80G
网络：100M
服务器IP：10.18.192.152	Windows 7 service pack1（虚拟机）
Apache-Jmeter-3.2
1.4.2	网络环境
负载产生机器：10.18.192.152网络环境。
本次测试为内网环境
重点测试网络是否存在性能瓶颈。
1.4.3	参数配置
测试环境为通用配置，无性能优化配置项。
1.5	测试资源
1.5.1	相关人员
开发人员：黄彦军
测试人员：唐念云
1.5.2	测试时间
版本号	内容描述	测试人员	测试时间	备注
V1.1	压力测试	唐念云	2017-9-14~2017-9-20	

1.5.3	相关测试工具
性能测试工具为Apache jmeter 3.2
1.6	预期性能指标
定义本次性能测试所需要的范围，定义相关性能检测点的性能需求。服务器端基本性能需求如下表：
性能检测指标	描述	指标参考值
系统的响应能力	在各种负载性能情况下，系统的响应时间，也就是从客户端交易发起，到服务器端交易应答返回所需要的时间，包括网络传输时间和服务器处理时间	任何操作平均时间不超过3秒
CPU的占用率	服务器CPU占用率，如果该值持续超过90%，表明瓶颈是CPU。可以考虑增加一个处理器或换一个更快的处理器或者是后台SQL以及数据结构的问题	小于85%。排除内存因素，如果该计数器的值比较大， 而同时网
卡和硬盘的值比较低，那么可以确定CPU 瓶颈
Memory Available MByte	可用内存数，不能有严重内存泄漏情况出现，如果测试时发现内存有变化情况也要注意，如果是内存泄露则比较严重	小于物理内存10％或更小，则说明计算机上总的内存可能不足，或某程序没有释放内存
 
具体检测的性能点指标如下：
检测的业务项	描述	指标参考值
获取短链接	调用短链接接口，获取短码。	时间最大不能超过3秒，平均不超过1秒
获取原链接	根据短链接接口返回的短码解析成对应的原链接URL。	时间最大不能超过3秒，平均不超过1秒
2	测试策略与方法
2.1	测试思路
获取短链接、获取原链接均先进行单一基线测试。再通过逐步加压，两个请求进行关联的方式，验证系统是否能处理现场要求、业务要求最大处理能力。最后，通过综合数据分析，将性能数据进行对比评估，进而验证该套系统是否达到发布要求。
2.2	测试流程
经与沟通，目前被测试系统，共分为2个功能模块，具体分别为：获取短码、短码解析成原URL。将两个接口调用根据短码进行关联，在同一脚本中进行测试。
2.3	测试规划
按照测试预期共执行二轮测试，总体测试目标如下所示：

测试轮数	测试目标	内部转测试版本
第一轮	1．	稳定版本

2．	将性能测试脚本，进行调试，并初步做性能测试，发现配置及性能瓶颈问题。	V1.0
第二轮	1.性能脚本进行持续2h压测	V1.1


3	性能测场景
3.1	核心模块测试场景
并发数场景设计：目前每天短信下发约10000条，为保持测试有效性以并发30个线程，同时为了扩展用途。
3.1.1	场景1
按照1秒线程数加到30并发运行2h，如下图所示：
 


4	测试结果
4.1	获取短链接、获取原链接（并发30用户）
4.1.1	第一轮测试Apache-jmeter-3.2 summary report如下：
 
分析：30用户并发运行10min即出现错误 服务端返回错误码1001(服务器异常)
4.1.2	第二轮Apache-jmeter-3.2 summary report如下：
 
短链接错误信息日志：
 
分析：
1.运行1小时46分钟无错误产生，之后由于测试服务器问题，redis原因，拒绝访问错误率提升。
2. 从上图分析总请求数为17984509，成功率为94.05%，失败数总体占比5.95%，失败率较高。 
3.从上图分析响应时间如下：
a）	获取短链接平均响应时间为13ms。
b）	获取原链接平均响应时间为10ms。
c）	获取短链接TPS(吞吐量)为1248.9/s。
d）	获取原链接TPS(吞吐量)为1249.1/s。
注：本次测试未设置thread delay事件即本次测试平均响应时间不包含用户thinktime 。

4.1.3	事务平均响应时间：
 
分析：
上图可以看出，整个性能测试过程中响应速度比较快，过滤了think_time时间之后，所有事务的响应时间都未超过5s，目前效果达到预期要求。
4.1.4	服务器性能状态
     服务器性能具体信息如下图：
 
CPU使用率为65%，剩余可用内存约为2G。内存使用率未超过65%，符合要求。
4.1.5	网络流量
      本次测试为内网环境
5	测试结论与建议
5.1	测试结论：
1）	第一轮测试过程中，30线程运行10分钟时则会出现大量错误，后经彦军修改后第二轮30并发运行1h30min时无错误产生。1小时46min后redis内存溢出停止服务，请求失败。
2）	获取短链接、获取原链接平均响应时间分别为13ms，10ms，响应时间较为快速。
3）	本次测试的为测试服务器(2核4G)为单机测试，与正式负载环境(单机4核8G，两台负载机)相比较差。失败的请求数集中在后15分钟。
4）	本次测试结果：可局限上线。上线后监控redis，确保无内存溢出情况。
